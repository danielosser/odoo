/** @odoo-module **/

import { Define } from '@mail/define';

export default Define`
    {Action}
        [Action/name]
            MessagingInitializer/_initPartners
        [Action/params]
            currentGuest
                [type]
                    Object
            current_partner
                [type]
                    Object
            current_user_id
                [type]
                    Integer
            partner_root
                [type]
                    Object
            messagingInitializer
                [type]
                    MessagingInitializer
            public_partners
                [type]
                    Collection<Object>
        [Action/behavior]
            {if}
                @currentGuest
            .{then}
                {Record/update}
                    [0]
                        @env
                    [1]
                        [Env/currentGuest]
                            {Record/insert}
                                @currentGuest
            {if}
                @current_partner
            .{then}
                {Record/update}
                    [0]
                        @env
                    [1]
                        [Env/currentPartner]
                            {Record/insert}
                                [Record/traits]
                                    Partner
                                {Partner/convertData}
                                    @current_partner
                                [Partner/user]
                                    {Record/insert}
                                        [Record/traits]
                                            User
                                        [User/id]
                                            @current_user_id
                        [Env/currentUser]
                            {Record/insert}
                                [Record/traits]
                                    User
                                [User/id]
                                    @current_user_id
            {Record/update}
                [0]
                    @env
                [1]
                    [Env/partnerRoot]
                        {Record/insert}
                            [Record/traits]
                                Partner
                            {Partner/convertData}
                                @partner_root
                    [Env/publicPartners]
                        {Record/link}
                            @public_partners
                            .{Collection/map}
                                {func}
                                    [in]
                                        item
                                    [out]
                                        {Record/insert}
                                            [Record/traits]
                                                Partner
                                            {Partner/convertData}
                                                @data
`;