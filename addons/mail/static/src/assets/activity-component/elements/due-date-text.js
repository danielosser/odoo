/** @odoo-module **/

import { Define } from '@mail/define';

import { auto_str_to_date } from 'web.time';

export default Define`
    {Element}
        [Element/name]
            dueDateText
        [Element/model]
            ActivityComponent
        [web.Element/textContent]
            :today
                {Record/insert}
                    [Record/traits]
                        web.Moment
                .{web.Moment/startOf}
                    day
            :momentDeadlineDate
                {Record/insert}
                    [Record/traits]
                        web.Moment
                    {String/autoToDate}
                        @record
                        .{ActivityComponent/activity}
                        .{Activity/dateDeadline}
            {Dev/comment}
                true means no rounding
            :diff
                {web.Moment/diff}
                    @momentDeadlineDate
                    @today
                    days
                    true
            {case}
                {entry}
                    [key]
                        @diff
                        .{=}
                            0
                    [value]
                        {Locale/text}
                            Today:
                {entry}
                    [key]
                        @diff
                        .{=}
                            -1
                    [valye]
                        {Locale/text}
                            Yesterday:
                {entry}
                    [key]
                        @diff
                        .{<}
                            -1
                    [value]
                        {String/sprintf}
                            [0]
                                {Locale/text}
                                    %d days overdue:
                            [1]
                                {Math/abs}
                                    @diff
                {entry}
                    [key]
                        @diff
                        .{=}
                            1
                    [value]
                        {Locale/text}
                            Tomorrow:
                {entry}
                    [key]
                        @diff
                        .{>}
                            1
                    [value]
                        {String/sprintf}
                            [0]
                                {Locale/text}
                                    Due in %d days:
                            [1]
                                @diff
        [web.Element/style]
            [web.scss/margin-inline-end]
                {scss/map-get}
                    {scss/$spacers}
                    2
            [web.scss/font-weight]
                bolder
            {if}
                @record
                .{ActivityComponent/activity}
                .{Activity/state}
                .{=}
                    default
            .{then}
                [web.scss/color]
                    {scss/$o-mail-activity-overdue-color}
            {if}
                @record
                .{ActivityComponent/activity}
                .{Activity/state}
                .{=}
                    overdue
            .{then}
                [web.scss/color]
                    {scss/$o-mail-activity-overdue-color}
            {if}
                @record
                .{ActivityComponent/activity}
                .{Activity/state}
                .{=}
                    planned
            .{then}
                [web.scss/color]
                    {scss/$o-mail-activity-planned-color}
            {if}
                @record
                .{ActivityComponent/activity}
                .{Activity/state}
                .{=}
                    today
            .{then}
                [web.scss/color]
                    {scss/$o-mail-activity-today-color}
`;
